<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><link rel=alternate type=application/rss+xml href=../blog/feed.xml title="Blog | adam-p"><meta name=google-site-verification content="WxZdzPANRFpehqogDMcTc9HLGXXDJy5If07MuUZvHho"><link rel=icon type=image/png href=../favicon.png><link rel=stylesheet href=../scss/styles.css><title>Blog | adam-p</title></head><body><nav class="navbar navbar-expand-md navbar-light bg-light"><div class=container-fluid><a class=navbar-brand href=../>adam-p</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=../blog/>Blog</a></li><li class=nav-item><a class=nav-link href=../inco/>In/Co</a></li><li class=nav-item><a class=nav-link href=../projects/>Projects</a></li><li class=nav-item><a class=nav-link href=../cv/>CV</a></li></ul></div></div></nav><div class=container-fluid><main><div><header><h1 class=title>Blog</h1><a href=../blog/feed.xml><i class="bi-rss-fill float-end"></i></a></header><p>Wherein I write about whatever occurs to me. But mostly software development stuff.</p></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2022/10/password-plus-plus/>More Than a Password</a></h4><div>2022-10-14</div><div class=post-body><div><p>Here&rsquo;s a quick-and-dirty explanation of why two-factor authentication is good, and why U2F/WebAuthn keys (like YubiKeys) are better than the alternatives. (So I have something to point friends and family at.)</p></div><div class="overflow-fade text-end"><h1><a href=../blog/2022/10/password-plus-plus/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2022/03/forwarded-header-sabotage/>Forwarded Header Sabotage</a></h4><div>2022-03-30</div><div class=post-body><div><p><a href=../blog/2022/03/x-forwarded-for/>We all know by now</a> that the leftmost values in the <code>X-Forwarded-For</code> header can be spoofed and only the rightmost IPs &ndash; added by your own reverse proxies &ndash; can be trusted. The <code>Forwarded</code> header (<a href=https://datatracker.ietf.org/doc/html/rfc7239>RFC 7239</a>, 2014) has that same problem, and a new one: If the header is parsed correctly, an attacker can <em>sabotage the whole header</em>.</p><p>Let&rsquo;s take a quick trip to understanding how that can happen and how complicated <code>Forwarded</code> parsing can get. (Think about how you&rsquo;d parse the header as we go.)</p></div><div class="overflow-fade text-end"><h1><a href=../blog/2022/03/forwarded-header-sabotage/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2022/03/strip-ipv6-zone/>Should you strip the IPv6 zone?</a></h4><div>2022-03-22</div><div class=post-body><div>There have recently been three different (but related) contexts where I have asked or been asked that question:
When a reverse proxy is adding the client IP to the X-Forwarded-For header. When the client IP is being used for rate limiting. When checking if a client IP is contained in a configured list of ranges/prefixes/CIDRs. As I understood more about zones my opinion on this changed. This is an attempt to capture my understanding and where I ended up.</div><div class="overflow-fade text-end"><h1><a href=../blog/2022/03/strip-ipv6-zone/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2022/03/go-netip-flaw/>A tiny flaw in Go's netip design</a></h4><div>2022-03-21</div><div class=post-body><div><p>Update 2022-03-23: Matt Layher <a href=https://github.com/golang/go/issues/51899>created a Go issue</a> about this.</p><p>Update 2022-04-14: In response to that issue, two weeks ago a change <a href=https://github.com/golang/go/commit/ae9ce822ff4015fbbe7aa4303e6f3c160f2c53af>was committed</a> to Go that makes <code>netip.ParsePrefix</code> behave like <code>net.ParseCIDR</code>: they both return an error when a zone is present. It wasn&rsquo;t released in 1.18.1, but I&rsquo;m guessing it&rsquo;ll be in 1.18.2. So that&rsquo;s great!</p><hr><p>Does this surprise you? (Try it in the <a href=https://go.dev/play/p/4bHXBiBktUH>playground</a>.)</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#75af00>prefix</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>netip</span><span style=color:#111>.</span><span style=color:#75af00>MustParsePrefix</span><span style=color:#111>(</span><span style=color:#d88200>&#34;fe80::%zone/10&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>addr</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>netip</span><span style=color:#111>.</span><span style=color:#75af00>MustParseAddr</span><span style=color:#111>(</span><span style=color:#d88200>&#34;fe80::1%zone&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#75af00>prefix</span><span style=color:#111>.</span><span style=color:#75af00>Contains</span><span style=color:#111>(</span><span style=color:#75af00>addr</span><span style=color:#111>))</span> <span style=color:#75715e>// ==&gt; false
</span></span></span></code></pre></div><p>Go&rsquo;s new-as-of-1.18 <a href=https://pkg.go.dev/net/netip><code>netip</code> package</a> is better in every way than the previous <code>net.IP</code>, etc., but this one design decision will probably burn someone, somewhere, sometime.</p></div><div class="overflow-fade text-end"><h1><a href=../blog/2022/03/go-netip-flaw/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2022/03/x-forwarded-for/>The perils of the “real” client IP</a></h4><div>2022-03-04</div><div class=post-body><div><h2 id=summary><a class=heading-anchor href=#summary>##</a>
Summary</h2><p>This post ended up being incredibly <del>long</del> comprehensive. I&rsquo;m afraid that many people won&rsquo;t read enough to get everything that&rsquo;s important, so here are the key points:</p><ul><li><p>When deriving the &ldquo;real client IP address&rdquo; from the <code>X-Forwarded-For</code> header, use the rightmost IP in the list.</p></li><li><p>The leftmost IP in the XFF header is commonly considered to be &ldquo;closest to the client&rdquo; and &ldquo;most real&rdquo;, but it&rsquo;s trivially spoofable. Don&rsquo;t use it for anything even close to security-related.</p></li><li><p>When choosing the rightmost XFF IP, make sure to use the <em>last</em> instance of that header.</p></li><li><p>Using special &ldquo;true client IPs&rdquo; set by reverse proxies (like <code>X-Real-IP</code>, <code>True-Client-IP</code>, etc.) <em>can</em> be good, but it depends on the a) how the reverse proxy actually sets it, b) whether the reverse proxy sets it if it&rsquo;s already present/spoofed, and c) how you&rsquo;ve configured the reverse proxy (sometimes).</p></li><li><p>Any header not specifically set by your reverse proxy cannot be trusted. For example, you <em>must not</em> check the <code>X-Real-IP</code> header if you&rsquo;re not behind Nginx or something else that always sets it, because you&rsquo;ll be reading a spoofed value.</p></li><li><p>A lot of rate limiter implementations are using spoofable IPs and are vulnerable to rate limiter escape and memory exhaustion attacks.</p></li></ul><p><em>If you use the &ldquo;real client IP&rdquo; anywhere in your code or infrastructure, you need to go check right now how you&rsquo;re deriving it.</em></p><p>This is all explained in detail below, so keep reading. It&rsquo;s a weird, scary, bumpy ride.</p></div><div class="overflow-fade text-end"><h1><a href=../blog/2022/03/x-forwarded-for/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2022/02/ipv6-rate-limiting/>The scary state of IPv6 rate-limiting</a></h4><div>2022-02-20</div><div class=post-body><div><p>IPv6 rate-limiting is scarily half-baked right now. If you run a server that does any kind of IP-based rate-limiting, consider not enabling IPv6 if possible. If you do use IPv6, check how your rate-limiter actually handles it.</p></div><div class="overflow-fade text-end"><h1><a href=../blog/2022/02/ipv6-rate-limiting/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2022/02/git-submodule-subtree/>Git Submodule vs Subtree</a></h4><div>2022-02-17</div><div class=post-body><div><p>Every now and then I need to make a choice between using git submodules or subtrees (or nothing), or I get asked about them by coworkers. This is infrequent enough that I forget some of the details each time and need to refresh my memory. So I wrote up these notes to share with my coworkers and to help my future self. Hopefully they’re of some use to others as well.</p></div><div class="overflow-fade text-end"><h1><a href=../blog/2022/02/git-submodule-subtree/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2022/01/golang-http-server-timeouts/>Diving into Go's HTTP server timeouts</a></h4><div>2022-01-15</div><div class=post-body><div>Recently, I was adding timeouts to a Go HTTP server and ended up exploring how the different settings and approaches act and interact. I&rsquo;m going to publish my notes here, along with the code I used for testing. Hopefully this will help someone else (or myself) in the future.
The timeout testing client can be found here: github.com/adam-p/httptimeout. There is a server in the examples directory that you can make requests to.</div><div class="overflow-fade text-end"><h1><a href=../blog/2022/01/golang-http-server-timeouts/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2021/11/ethics-travel-time/>The Ethics of Driving Speed in Travel Time Estimation</a></h4><div>2021-11-28</div><div class=post-body><div>How should travel time be estimated? What are the ethical implications of the approach taken?
You enter your destination into your maps app. It finds a few likely routes. It determines the distance of each pretty easily. It checks traffic conditions along the routes. But we don&rsquo;t yet have a travel time estimate. Time equals distance divided by speed, adjusted for traffic.
What travel speed (traffic notwithstanding) does the app use?</div><div class="overflow-fade text-end"><h1><a href=../blog/2021/11/ethics-travel-time/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2021/11/constant-time-network/>Timing attack mitigation must exclude network</a></h4><div>2021-11-27</div><div class=post-body><div>TL;DR: When trying to prevent timing attacks (e.g., against login username enumeration) by making a request take constant time, make sure you exclude the network read and write time. If you don&rsquo;t, an attacker can slow down their request to bypass it.
I&rsquo;ll be covering some background and contextual information here. If you don&rsquo;t need it, skip to &ldquo;Exclude network time from constant-time limiting&rdquo;.
## What is a &ldquo;timing attack&rdquo;? Briefly, a timing attack (in this context) is when an attacker observes the time it takes for a server to handle a request to glean some information about the validity of the input they tried.</div><div class="overflow-fade text-end"><h1><a href=../blog/2021/11/constant-time-network/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2021/06/backup-yubikey/>Make sure you have a backup Yubikey</a></h4><div>2021-06-25</div><div class=post-body><div>For four years I carried a Yubikey NEO (USB Type-A) in my pocket, on my keychain. And then it died (would no longer be recognized by any computer).
Yubikey&rsquo;s durability claim was:
Crush-resistant and waterproof, YubiKey NEO is practically indestructible during normal use, weighs only 3g, and attaches to your keychain alongside your house and car keys
So, they didn&rsquo;t explicitly say &ldquo;carrying it on your keychain won&rsquo;t kill it&rdquo;, but they sure did imply it.</div><div class="overflow-fade text-end"><h1><a href=../blog/2021/06/backup-yubikey/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2021/06/unicode-url-length/>Dev Story: Unicode URL length limit blues</a></h4><div>2021-06-07</div><div class=post-body><div>I have enjoyed reading other people&rsquo;s design and debugging train-of-thought posts, so after I spent two days wrestling with a code problem, I thought I&rsquo;d write it up. It&rsquo;s not technically exciting, but I think that describing it might be useful to someone &ndash; or my future self &ndash; someday. Or, at the very least, a little amusing.
(Bonus: While writing this I discovered an error I made while doing the actual work.</div><div class="overflow-fade text-end"><h1><a href=../blog/2021/06/unicode-url-length/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2019/05/breached/>The short happy life of the Breached extension</a></h4><div>2019-05-27</div><div class=post-body><div>In October 2017, Troy Hunt of Have I Been Pwned held a contest inviting people to do something cool with the HIBP API. I decided a) that I would kind of like the special edition ThinkPad he was giving away, and b) that I could probably whip something up pretty quickly.
I decided to create a browser extension that would simply pull HIBP breach information and show a browser notification &ndash; with the ability to view extra info &ndash; when the user visited a site that had been breached.</div><div class="overflow-fade text-end"><h1><a href=../blog/2019/05/breached/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2016/07/mdh-dividing-firefox-and-thunderbird/>Markdown Here: Splitting the Firefox and Thunderbird Extension</a></h4><div>2016-07-14</div><div class=post-body><div>[This started as notes to myself to help clarify the problem and solution. It&rsquo;s probably more suited to a Github issue than a blog post, and it may get copied into one.]
# The story so far The Firefox and Thunderbird versions of Markdown Here both used nearly the same code &ndash; an old-style XUL extension. Tb is only capable of using a XUL extension, while Fx supports at least three extension types: XUL-based, Add-on SDK (aka Jetpack, aka jpm), and WebExtensions.</div><div class="overflow-fade text-end"><h1><a href=../blog/2016/07/mdh-dividing-firefox-and-thunderbird/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2016/05/smart-lock-mock-location/>Android Non-Vulnerability: Steal a Device and Keep it Unlocked</a></h4><div>2016-05-11</div><div class=post-body><div>While poking around in my Android phone&rsquo;s developer options, I realized that if you steal a phone that&rsquo;s currently unlocked because it&rsquo;s in a &ldquo;trusted place&rdquo;, then you can force it to remain unlocked forever. (And then I got schooled about that not being a problem.)
## Security Feature: Smart Lock with Trusted Places Android&rsquo;s Smart Lock allows users to configure conditions under which to keep the phone unlocked. One of the conditions is location &ndash; you can set trusted locations where your phone shouldn&rsquo;t prompt for a PIN/pattern/password when unlocking.</div><div class="overflow-fade text-end"><h1><a href=../blog/2016/05/smart-lock-mock-location/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2015/02/contributor-license-agreement/>Why and How to Use a Contributor License Agreement</a></h4><div>2015-02-17</div><div class=post-body><div>## Background and Motivation I received a pull request for Markdown Here that was great: it found a bug, fixed it, and included tests for the fix. However, the PR submitter didn&rsquo;t write the tests using the existing framework, so I figured I&rsquo;d massage his test code into the proper form.
And then I noticed that he included a copyright line in the test file. It says &ldquo;MIT License&rdquo;, which is the license used for the rest of the project, but that got me thinking about what that might mean&mldr;</div><div class="overflow-fade text-end"><h1><a href=../blog/2015/02/contributor-license-agreement/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2013/10/mdh-disqus-test/>Test post: Markdown Here in Disqus</a></h4><div>2013-10-18</div><div class=post-body><div>This is just a stub test post to allow me to try out Markdown Here in Disqus comments.
Right now MDH won&rsquo;t work with Disqus in Chrome because of cross-origin restrictions. See: https://github.com/adam-p/markdown-here/issues/124
Update: The Disqus edit box is contenteditable, and MDH will render in it, but all formatting seems to get stripped out when you actually post the comment. Seems like the rich-edit-ness is probably just to support Disqus&rsquo;s add-an-image feature.</div><div class="overflow-fade text-end"><h1><a href=../blog/2013/10/mdh-disqus-test/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2013/06/safari-extensions-gallery-half-baked/>Safari Extensions Gallery: half-baked</a></h4><div>2013-06-25</div><div class=post-body><div>Trying to get Markdown Here listed in the Safari Extensions Gallery is by far the worst browser extension &ldquo;store&rdquo; experience I&rsquo;ve had so far. Shockingly bad.
## No hosting First of all, but least of all: There&rsquo;s no hosting. Unlike the Chrome and Mozilla stores, the Safari store doesn&rsquo;t host the extension for you &ndash; it&rsquo;s really more of a listing of links to wherever you host your extension files. That&rsquo;s not terrible, but:</div><div class="overflow-fade text-end"><h1><a href=../blog/2013/06/safari-extensions-gallery-half-baked/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../blog/2013/03/pageaction-interaction/>No One Knows to Click on a Page Action</a></h4><div>2013-03-24</div><div class=post-body><div>Page actions &ndash; the buttons in a browser&rsquo;s address bar &ndash; are a surprising UI failure.
When adding a button for a browser extension, a choice must be made whether to make it a &ldquo;page action&rdquo; or a &ldquo;browser action&rdquo; (button on the toolbar). But browsers have failed to communicate the interactiveness of page actions, and almost no one &ndash; techy or layman &ndash; realizes that they&rsquo;re clickable.
To complement the context menu item and hotkey, and to fulfil a user feature request, I decided to add a button to the Markdown Here browser extension.</div><div class="overflow-fade text-end"><h1><a href=../blog/2013/03/pageaction-interaction/>>>></a></h1></div></div></div></div></div></main><footer class=text-end><small>© 2022 Adam Pritchard</small></footer></div><script src=../node_modules/bootstrap/dist/js/bootstrap.js></script></body></html>