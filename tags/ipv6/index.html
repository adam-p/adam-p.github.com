<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><link rel=alternate type=application/rss+xml href=../../tags/ipv6/feed.xml title="Ipv6 | adam-p"><meta name=google-site-verification content="WxZdzPANRFpehqogDMcTc9HLGXXDJy5If07MuUZvHho"><link rel=icon type=image/png href=../../favicon.png><link rel=stylesheet href=../../scss/styles.css><title>Ipv6 | adam-p</title></head><body><nav class="navbar navbar-expand-md navbar-light bg-light"><div class=container-fluid><a class=navbar-brand href=../../>adam-p
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=../../blog/>Blog</a></li><li class=nav-item><a class=nav-link href=../../inco/>In/Co</a></li><li class=nav-item><a class=nav-link href=../../projects/>Projects</a></li><li class=nav-item><a class=nav-link href=../../cv/>CV</a></li></ul></div></div></nav><div class=container-fluid><main><div><header><h1 class=title>Ipv6</h1><a href=../../tags/ipv6/feed.xml><i class="bi-rss-fill float-end"></i></a></header></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../../blog/2022/03/strip-ipv6-zone/>Should you strip the IPv6 zone?</a></h4><div>2022-03-22</div><div class=post-body><div><p>There have recently been three different (but related) contexts where I have asked or been asked that question:</p><ol><li>When a reverse proxy is adding the client IP to the <code>X-Forwarded-For</code> header.</li><li>When the client IP is being used for rate limiting.</li><li>When checking if a client IP is contained in a configured list of ranges/prefixes/CIDRs.</li></ol><p>As I understood more about zones my opinion on this changed. This is an attempt to capture my understanding and where I ended up.</p></div><div class="overflow-fade text-end"><h1><a href=../../blog/2022/03/strip-ipv6-zone/>>>></a></h1></div></div></div></div></div><hr><div class=row-fluid><div class="span12 post-excerpt"><div class=post-specs><h4><a href=../../blog/2022/03/go-netip-flaw/>A tiny flaw in Go's netip design</a></h4><div>2022-03-21</div><div class=post-body><div><p>Update 2022-03-23: Matt Layher <a href=https://github.com/golang/go/issues/51899>created a Go issue</a> about this.</p><p>Update 2022-04-14: In response to that issue, two weeks ago a change <a href=https://github.com/golang/go/commit/ae9ce822ff4015fbbe7aa4303e6f3c160f2c53af>was committed</a> to Go that makes <code>netip.ParsePrefix</code> behave like <code>net.ParseCIDR</code>: they both return an error when a zone is present. It wasn&rsquo;t released in 1.18.1, but I&rsquo;m guessing it&rsquo;ll be in 1.18.2. So that&rsquo;s great!</p><hr><p>Does this surprise you? (Try it in the <a href=https://go.dev/play/p/4bHXBiBktUH>playground</a>.)</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#75af00>prefix</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>netip</span><span style=color:#111>.</span><span style=color:#75af00>MustParsePrefix</span><span style=color:#111>(</span><span style=color:#d88200>&#34;fe80::%zone/10&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>addr</span> <span style=color:#f92672>:=</span> <span style=color:#75af00>netip</span><span style=color:#111>.</span><span style=color:#75af00>MustParseAddr</span><span style=color:#111>(</span><span style=color:#d88200>&#34;fe80::1%zone&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#75af00>fmt</span><span style=color:#111>.</span><span style=color:#75af00>Println</span><span style=color:#111>(</span><span style=color:#75af00>prefix</span><span style=color:#111>.</span><span style=color:#75af00>Contains</span><span style=color:#111>(</span><span style=color:#75af00>addr</span><span style=color:#111>))</span> <span style=color:#75715e>// ==&gt; false</span>
</span></span></code></pre></div><p>Go&rsquo;s new-as-of-1.18 <a href=https://pkg.go.dev/net/netip><code>netip</code> package</a> is better in every way than the previous <code>net.IP</code>, etc., but this one design decision will probably burn someone, somewhere, sometime.</p></div><div class="overflow-fade text-end"><h1><a href=../../blog/2022/03/go-netip-flaw/>>>></a></h1></div></div></div></div></div></main><footer class=text-end><small>Â© 2025 Adam Pritchard</small></footer></div><script src=../../node_modules/bootstrap/dist/js/bootstrap.js></script></body></html>